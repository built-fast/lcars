#!/usr/bin/env bash
# Usage: lcars history-lesson [MM/DD]
# Summary: Prints random facts for a date
#
# NAME
#   lcars history-lesson -- Prints random facts for a date
#
# SYNOPSIS
#   lcars history-lesson [MM/DD]
#
# DESCRIPTION
#   lcars history-lesson prints random facts for the specified date in MM/DD format.
#   If no date is provided, defaults to today's date.

if [[ "$LCARS_DEBUG" ]]; then
  export PS4='+ [${BASH_SOURCE##*/}:$LINENO] '
  set -x
fi

if [[ -z "$_LCARS_ROOT" ]]; then
  echo "Error: Must run \`${0//*\/lcars-/lcars }' instead."
  exit 1
fi

set -euo pipefail

if [[ $# -eq 1 ]]; then
  date_arg="$1"
  if [[ ! "$date_arg" =~ ^[0-9]{1,2}/[0-9]{1,2}$ ]]; then
    echo "Error: Date must be in MM/DD format" >&2
    exit 1
  fi
  month=$(printf "%02d" "${date_arg%/*}")
  day=$(printf "%02d" "${date_arg#*/}")
  search_date="$month/$day"
  echo "Random Facts for $search_date"
else
  search_date="$(date '+%m/%d')"
  echo "Today's Random Facts"
fi

echo "===================="
echo
grep -h "^$search_date" "$_LCARS_ROOT/share/lcars/calendars/calendar."* |
  cut -f2 | awk '{ print "- " $0 }'
